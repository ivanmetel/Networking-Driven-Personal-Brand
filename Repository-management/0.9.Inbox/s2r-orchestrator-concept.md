---
type: doc
status: draft
created: 2026-01-15
updated: 2026-01-15
family: F0
scope: repository
---

# Концепция: S2R Orchestrator — ассистент, который превращает знания и правила в рабочие документы

**S2R Orchestrator** — это система, которая отвечает на запросы пользователя не "из головы", а через управляемую сборку контекста из репозиториев и профиля пользователя, затем применяет набор инструкций (правил работы) и производит **выходные документы** (артефакты). Эти выходные документы далее могут становиться **новыми входными данными**: попадать в репозиторий, индекс знаний и профиль пользователя.

Смысл: превратить работу с ИИ из "чата" в **производственную линию документов**, где:

* **данные** (контент) отделены от **действий** (инструкций),
* сбор контекста воспроизводим и проверяем,
* результаты версионируются и переиспользуются.

---

## Чёткое разделение: данные vs действия

| Слой                               | Что это                                                                                                | Примеры                                                                                                                                                                          | Что отдаём на вход/выход                                                                   |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ |
| **ДАННЫЕ (входной контекст)**      | Информация, из которой ИИ может извлечь смысл и факты                                                  | репозиторий S2R (семейства/ядра/шаблоны), репозиторий "индекса знаний" пользователя, артефакты прошлых работ, выдержки из источников, профиль/цифровой двойник (если разрешено)  | **Вход:** "пакет контекста" (подборка выдержек + ссылки/идентификаторы)                    |
| **ДЕЙСТВИЯ (инструкции)**          | Правила, по которым система интерпретирует запрос, собирает контекст, рассуждает и оформляет результат | распознавание роли/намерения, маршрутизация по S2R, поиск+переранжирование, сжатие контекста, проверка согласий на личные данные, шаблоны выходных документов, критерии качества | **Выход:** документ(ы) по шаблону + метаданные (почему так, что использовано)              |
| **ВЫХОДНЫЕ ДОКУМЕНТЫ (артефакты)** | Результат работы, который может стать новым знанием                                                    | ТЗ, спецификация, план, критика/улучшения, чеклист, "name card", политика/регламент, кусок репозитория                                                                           | **Выход:** файл/док + карта контекста; **потом:** индексирование и повторное использование |

---

## Почему это опирается на SoTA

Ваша задумка соответствует современным устойчивым паттернам построения LLM-систем:

1. **Retrieval-Augmented Generation (RAG):** связка "генерация + внешняя память", чтобы ответы опирались на обновляемые источники, а не только на параметры модели. Это базовая парадигма в knowledge-intensive задачах. ([arXiv](https://arxiv.org/abs/2005.11401))

2. **Dense retrieval (двухэнкодерные ретриверы):** практичный способ находить релевантные фрагменты по смыслу в больших корпусах (в т.ч. внутренних). ([arXiv](https://arxiv.org/abs/2004.04906))

3. **Reranking (cross-encoder):** стандартный SoTA-приём: сначала быстро достать кандидатов, затем более "умной" моделью переранжировать топ-N, чтобы резко поднять точность контекста. ([arXiv](https://arxiv.org/abs/1901.04085))

4. **HyDE / query expansion через генерацию:** улучшение поиска, когда запрос пользователя короткий/смутный: сначала генерируется "гипотетический документ", затем по нему ищем. ([arXiv](https://arxiv.org/abs/2212.10496))

5. **Agentic pattern "Reason + Act":** разделение рассуждений и действий (поиск, извлечение, выбор инструментов) — один из ключевых современных подходов к сложным задачам. ([arXiv](https://arxiv.org/abs/2210.03629))

6. **Уплотнение/нормализация инструкций для инструментов и документации:** отдельная линия исследований показывает, что качество tool-use растёт, когда документация преобразована в короткие, унифицированные инструкции. Это напрямую применимо к вашему S2R как "инструкции для поведения". ([aclanthology.org](https://aclanthology.org/2025.naacl-long.44.pdf))

---

## Концепция использования (как команда это будет применять)

**Кто пользователь:** человек приходит с вопросом, но всегда в некотором "режиме" (роль) и с фокусом на некоторый объект/систему интереса.

**Что делает система:**

1. понимает, *какого типа результат* нужен (совет, план, документ, критика, ТЗ),
2. собирает контекст из S2R + (по необходимости) базы знаний пользователя,
3. применяет инструкции рассуждения (в т.ч. внутренние правила анализа),
4. выпускает **рабочий артефакт** в заданной форме,
5. сохраняет артефакт как новое знание.

**Два режима эксплуатации:**

* **Режим "быстрый":** минимум уточнений, компактный контекст, быстрый артефакт (черновик).
* **Режим "строгий":** уточнение цели/формата, явный "пакет контекста", проверки качества, сохранение в репозиторий как версия.

---

## Процесс работы системы (pipeline)

### 0) Вход

* Запрос пользователя.
* Контекст диалога.
* (Опционально) разрешение на использование личных данных/цифрового двойника.

### 1) Интерпретация запроса

* Определить тип выхода: **ответ / план / ТЗ / критика / спецификация / чеклист / пост / инструкция**.
* Сформировать 2–3 гипотезы "режима пользователя" и "объекта интереса" с уверенностью.
* Если уверенность низкая — задать **один** уточняющий вопрос про формат результата (не про внутренние термины).

### 2) План сборки контекста (Context Plan)

* Определить, какие части S2R наиболее релевантны (семейства/перспективы/шаблоны).
* Определить, нужен ли индекс знаний пользователя.
* Определить, нужен ли цифровой профиль (и только если есть согласие).

### 3) Сбор данных (Retrieval)

* Поиск кандидатов по S2R и по индексу знаний (lexical + semantic).
* Опционально: HyDE/расширение запроса, если запрос короткий/смутный.

### 4) Отбор и сжатие (Rerank + Compress)

* Переранжировать топ-N кандидатов cross-encoder'ом.
* Сжать в **пакет контекста**:
  * 6–15 коротких выдержек,
  * идентификаторы/ссылки на первоисточники,
  * список "что намеренно не использовано" (если важно).

### 5) Рассуждение (внутренняя логика)

* Применить внутреннюю методологию рассуждений (в т.ч. "рассуждения по FPF") как **движок анализа**, но:
  * для пользователя показывать только то, что полезно,
  * избегать "метаязыка" в выдаче, если это не внутренний документ.

### 6) Генерация артефакта

* Выбрать шаблон документа (из S2R или заданный пользователем).
* Сформировать результат:
  * основной текст,
  * допущения/ограничения,
  * критерии качества / риски / next steps.

### 7) Контроль качества

* Проверка на:
  * соответствие формату,
  * полноту (обязательные секции),
  * непротиворечивость,
  * корректное использование личных данных (если были).
* Если нужно — вернуть "версия 0.9" и список вопросов/дыр.

### 8) Сохранение (выход становится входом)

* Сохранить артефакт в репозиторий/хранилище:
  * документ,
  * метаданные (тип, объект, режим, использованные источники),
  * связь с задачей/проектом.
* Обновить индекс знаний.
* Обновить цифровой профиль (только допустимые агрегаты/сигналы и только при разрешении).

---

## Политика использования цифрового двойника (минимально необходимая)

**Три режима:**

1. **По умолчанию:** не использовать личные данные.
2. **Только из текущего диалога.**
3. **Полный профиль/индекс знаний:** только после явного подтверждения, с перечислением, какие разделы будут задействованы.

---

## Минимальная дорожная карта (MVP → Production)

### Этап 1 — MVP "ручная маршрутизация"

* Шаблоны выходных документов (минимум 5: критика, план, ТЗ, спецификация, чеклист).
* "Пакет контекста" как объект (структура + лимиты).
* Ручной выбор релевантных разделов S2R (без авто-раутера).
* Логи: что использовано, какой шаблон, какой выход.

**Критерий успеха:** команда стабильно получает качественные артефакты из S2R без хаоса.

### Этап 2 — Auto-routing + RAG-пайплайн

* Реестр (YAML/JSON) для разделов S2R: назначение, типы запросов, выходные артефакты.
* Dense retrieval + reranking.
* HyDE как опция для "плохих" запросов.
* Автоматическая сборка "пакета контекста".

**Критерий успеха:** качество не хуже ручного, а скорость выше.

### Этап 3 — Профиль/цифровой двойник и права доступа

* Механизм согласий и режимов.
* Подключение индекса знаний пользователя как отдельного источника.
* Политики хранения и аудит использования личных данных.

**Критерий успеха:** персонализация без потери доверия и без утечек.

### Этап 4 — Качество и эксплуатация

* Набор эталонных сценариев (evaluation set).
* Метрики: точность контекста, доля "принято без правок", число итераций, время до полезного артефакта.
* Регламент обновления S2R и шаблонов (versioning, changelog).

---

## Что команде нужно "сделать вместе" (краткий список работ)

1. Определить **набор типов выходных артефактов** (и формат каждого).
2. Зафиксировать **структуру "пакета контекста"** (схема + лимиты).
3. Описать **реестр S2R** (машинно-читаемая маршрутизация).
4. Реализовать **retrieval + rerank + compress**.
5. Ввести **режимы использования личных данных** и логи аудита.
6. Сделать **pipeline сохранения**: выход → репозиторий → индекс → повторное использование.
7. Собрать **набор эталонных задач** для оценки качества.

---

## См. также

- [CLAUDE.md](../../CLAUDE.md) — текущие инструкции для AI
- [02-document-families.md](../0.1.Knowledge-Logic/02-document-families.md) — семейства документов
- [roles-matrix.md](../0.3.Roles-Matrix-3x3/roles-matrix.md) — матрица ролей
